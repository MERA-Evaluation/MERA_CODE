# RealCode


## Описание задачи

**RealCodeFG** — это бенчмарк для оценки способности моделей дописывать тело функции в реальных Python-проектах. Задачи построены на основе настоящих репозиториев и валидируются через выполнение юнит-тестов.

Тестируемые навыки моделей: Code completion, Context-aware generation

Авторы: Павел Задорожный, Родион Левичев, Павел Адаменко, Айдар Валеев, Дмитрий Бабаев, Денис Кокосинский


## Мотивация

Датасет проверяет, насколько хорошо модели:
- Дополняют тело функции по контексту (`left_context`);
- Интегрируются в существующий проект без нарушения логики;
- Проходят реальные тесты после вставки тела.
Основная метрика — `pass@k`, оценивающая успешное выполнение тестов в Docker-среде.


## Описание датасета

### Поля данных

Каждый вопрос в датасете содержит следующие поля:

- `instruction` [str] — строка, содержащая формулировку задания по генерации тела функции;
- `inputs` — Вводные данные, формирующие задание для модели. Могут включать одну или несколько модальностей - видео, аудио, изображение, текст.
    - `left_context` [str] — код перед функцией, включая импорты и классы;
- `outputs` [str] — одномерный массив строк размера n_samples, где n_samples — количество требуемых сэмплов для подсчета pass@k;
- `meta` — Метаданные, относящиеся к тестовому примеру, но не используемые в вопросе (скрытые от тестируемой модели).
    - `id` [int] — уникальный идентификатор примера;
    - `repo` [str] — имя GitHub-репозитория, из которого извлечена задача;
    - `base_commit` [str] — хэш коммита, зафиксировавшего состояние репозитория;
    - `gt` [str] — тело функции-истины без сигнатуры;
    - `right_context` [str] — код после функции, включая другие функции и классы;
    - `left_context` [str] — код перед функцией, включая импорты и классы;
    - `image_name` [str] — Docker-образ, в котором выполняется проект;
    - `build_command` [str] — команда для сборки проекта перед тестами;
    - `test_command` [str] — команда запуска тестов;
    - `fn` [str] — путь до файла, в котором находится функция;
    - `PASS_TO_PASS` [list] — список тестов, которые успешно проходят;
    - `FAIL_TO_PASS` [list] — список тестов, которые перестали падать;
    - `intent` [str] — название функции или метода;
    - `intent_type` [str] — тип элемента (function, class и т.д.)


### Пример данных

```json
{
    "instruction": "Контекст:\n```python\n{left_context}\n```\nТребуется: только тело функции. Строго соблюдай отступы Python. Не добавляй лишнего текста.",
    "inputs": {
        "left_context": "from slack_sdk import WebClient\n\nclass SlackProgressBar:\n    def __init__(self, token: str, total: int):"
    },
    "outputs": "        self._client = WebClient(token=token)\n        self._total = total",
    "meta": {
        "id": 1,
        "repo": "mlizzi/slack-progress-bar",
        "base_commit": "d2d6d955fb8a0423ab89c1bac6c4f70101e6b8af",
        "gt": "        self._client = WebClient(token=token)\n        self._total = total",
        "right_context": "    def update(self, value: int) -> None:\n        pass",
        "left_context": "from slack_sdk import WebClient\n\nclass SlackProgressBar:\n    def __init__(self, token: str, total: int):",
        "image_name": "python:3.11.11-slim-bookworm",
        "build_command": "pip install .; pip install pytest; pip install pytest-json-report;",
        "test_command": "pytest tests --json-report --json-report-file=report_pytest.json",
        "fn": "slack_progress_bar/slack_progress_bar.py",
        "PASS_TO_PASS": [
            "tests/test_slack_progress_bar.py::test_slack_progress_bar"
        ],
        "FAIL_TO_PASS": [],
        "intent": "__init__[function]",
        "intent_type": "function"
    }
}
```


### Промпты

Для задачи были подготовлены 10 промптов, которые были равномерно распределены по вопросам по принципу "один вопрос – один промпт". Шаблоны в фигурных скобках в промпте заполняются из полей внутри поля `inputs` в каждом вопросе.


Пример промпта:

```
Контекст:```python
{left_context}```Требуется: продолжить только тело одной функции. Строго соблюдай отступы Python. Не добавляй лишнего текста и не пиши другие функции. Твоя генерация будет вставлена сразу после контекста
```


### Создание датасета

Бенчмарк построен на основе 95 GitHub-репозиториев, созданных в 2024 году. Всего 802 задачи: для каждой задачи извлекается функция, ее контекст и проверяется прохождение изначальных тестов при генерации нового тела. Все примеры валидны и воспроизводимы.


## Оценка


### Метрики

Для агрегированной оценки ответов моделей используются следующие метрики:

- `pass@1`: доля задач, в которых хотя бы одна генерация прошла все тесты
- `pass_oracle@1`: доля задач, в которых ground truth решение проходит все тесты (верхняя граница)
- `pass_stub_pass@1`: доля задач, в которых заглушка `return pass` прошла хотя бы один тест
- `pass_stub_empty_str@1`: доля задач, в которых заглушка `return ""` прошла хотя бы один тест
- `pass_dry_run@1`: доля задач, где хотя бы одна генерация прошла тесты в режиме dry-run (без использования ground truth)
- `execution_success`: доля задач, в которых проект успешно собрался и тесты запустились без сбоев
- `num_samples`: общее количество задач в датасете
